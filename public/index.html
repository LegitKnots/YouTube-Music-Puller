<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spotify → YouTube (Official Audio)</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 2rem auto; }
    button { padding: .6rem 1rem; }
    input { padding: .5rem; width: 100%; max-width: 420px; }
    .row { margin: 1rem 0; }
    .muted { color: #666; font-size: .9rem; }
    a.btn { display:inline-block; padding:.6rem 1rem; border:1px solid #ccc; border-radius:6px; text-decoration:none }
  </style>
</head>
<body>
  <h1>Spotify → YouTube (Official Audio)</h1>
  <p class="muted">Tip: first click <b>Login to Spotify</b> to mint/refresh your token (one-time).</p>

  <div class="row">
    <a class="btn" href="/auth/login">Login to Spotify</a>
  </div>

  <div class="row">
    <label><input type="radio" name="mode" value="liked" checked> Liked Songs</label>
    &nbsp;&nbsp;
    <label><input type="radio" name="mode" value="playlist"> Playlist ID</label>
  </div>

  <div class="row" id="plRow" style="display:none">
    <input id="playlistId" placeholder="Spotify Playlist ID (e.g. 37i9dQZF...)" />
  </div>

  <div class="row">
    <button id="runBtn">Run</button>
  </div>

  <pre id="log" style="white-space:pre-wrap;background:#f6f6f6;border:1px solid #ddd;padding:1rem;border-radius:6px"></pre>

  <script>
    const log = (m) => { document.getElementById('log').textContent += m + '\n'; };
    const radios = document.querySelectorAll('input[name="mode"]');
    const plRow = document.getElementById('plRow');
    radios.forEach(r => r.addEventListener('change', () => {
      plRow.style.display = (document.querySelector('input[name="mode"]:checked').value === 'playlist') ? 'block' : 'none';
    }));

    document.getElementById('runBtn').onclick = async () => {
      document.getElementById('log').textContent = '';
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const playlistId = document.getElementById('playlistId').value.trim();

      log('Starting… this may take a few minutes depending on list size.');
      const res = await fetch('/api/run', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ mode, playlistId: playlistId || undefined })
      });
      const data = await res.json();
      if (!res.ok) {
        log('Error: ' + (data.error || res.statusText));
        return;
      }
      log(`Done. Processed ${data.count} tracks.`);
      log(`JSON: ${location.origin}${data.json}`);
      log(`CSV : ${location.origin}${data.csv}`);
    };
  </script>
</body>
</html>
